#On actions about titles

# A title is destroyed
# root = the holder before destruction
# scope:landed_title = the title that is being destroyed
on_title_destroyed = {
	events = {
	}
}

# A title is transferred to a new character
# root = the new holder
# scope:title = the title that changes hands
# scope:previous_holder = previous holder. Might be dead
on_title_gain = {
	effect = {
		if = {
			limit = {
				scope:title = { is_holy_order = yes }
				NOT = { has_trait = order_member }
				has_government = holy_order_government
			}
			add_trait = order_member
		}

		#Did I receive a title from my sibling?
		if = {
			limit = {
				exists = scope:previous_holder
				scope:previous_holder = {
					is_alive = yes
					exists = var:sibling_waiting_for_land
					any_sibling = {
						this = root
						this = scope:previous_holder.var:sibling_waiting_for_land
					}
				}
			}
			add_character_flag = {
				flag = got_title_from_sibling
				years = 4
			}
		}
###TALES OF IRELAND###
		#High King claim
		if 	= {
			limit = {
				root = {
					AND = {
						is_independent_ruler = yes
						OR = {
							highest_held_title_tier = 3
							highest_held_title_tier = 4
							highest_held_title_tier = 5
						}
					}
				}
			}
			add_pressed_claim = title:k_high_kingship
		}
		if 	= {
			limit = {
				root.liege = {
					has_trait = fomorian
				}
			}
			add_trait = fomorian
		}
		if 	= {
			limit = {
				root.liege = {
					has_trait = cessarian
				}
			}
			add_trait = cessarian
		}
		if 	= {
			limit = {
				root.liege = {
					has_trait = partholonian
				}
			}
			add_trait = partholonian
		}
		if 	= {
			limit = {
				root.liege = {
					has_trait = nemedian
				}
			}
			add_trait = nemedian
		}
		if 	= {
			limit = {
				root.liege = {
					has_trait = fir_bolg
				}
			}
			add_trait = fir_bolg
		}
		if 	= {
			limit = {
				root.liege = {
					has_trait = tuatha_de_danann
				}
			}
			add_trait = tuatha_de_danann
		}
		if 	= {
			limit = {
				root.liege = {
					has_trait = milesian
				}
			}
			add_trait = milesian
		}
		if 	= {
			limit = {
				root.liege = {
					has_trait = celtic_human
				}
			}
			add_trait = celtic_human
		}
		if 	= {
			limit = {
				root.liege = {
					has_trait = megalith_human
				}
			}
			add_trait = megalith_human
		}
		
		
		if = {
			limit = {has_culture_group = culture_group:toi_fomorian_group}
				add_trait = fomorian
			}
		if = {
		limit = {has_culture_group = culture_group:toi_cessarian_group}
			add_trait = cessarian
		}
		if = {
		limit = {has_culture_group = culture_group:toi_cruithin_group}
			add_trait = celtic_human
		}
		if = {
		limit = {has_culture_group = culture_group:toi_de_danann_group}
			add_trait = tuatha_de_danann
		}
		if = {
		limit = {has_culture_group = culture_group:toi_erainn_group}
			add_trait = celtic_human
		}
		if = {
		limit = {has_culture_group = culture_group:toi_laigin_group}
			add_trait = celtic_human
		}
		if = {
		limit = {has_culture_group = culture_group:toi_fir_bolg_group}
			add_trait = fir_bolg
		}
		if = {
		limit = {has_culture_group = culture_group:toi_meghalithic_group}
			add_trait = megalith_human
		}
		if = {
		limit = {has_culture_group = culture_group:toi_milesian_group}
			add_trait = milesian
		}
		if = {
		limit = {has_culture_group = culture_group:toi_nemedian_group}
			add_trait = nemedian
		}
		if = {
		limit = {has_culture_group = culture_group:toi_partholonian_group}
			add_trait = partholonian
		}
		add_trait = celtic_human
###TALES OF IRELAND###
	}
	events = {
		#Test event for title destruction on-action.

		religious_decision.0312 #New holder of a county with a runestone
		coa.1 # check if title Coat of Arms should change.
	}
}

# A title is inherited by a character
# root = the new holder
# scope:title = the title that changes hands
# scope:previous_holder = previous holder. Should be dead
###TALES OF IRELAND ANCIENT PARTITION
on_title_gain_inheritance = {
	events = {
	}
	effect = {
		create_title_and_vassal_change = {
			type = independency
			save_scope_as = change
		}
		root = {
			change_liege_or_become_independent = {
				CHANGE = scope:change
				VASSAL = this
			}
		}
	}
}
###TALES OF IRELAND ANCIENT PARTITION END

# A title is usurped by a character
# root = the new holder
# scope:title = the title that changes hands
# scope:previous_holder = previous holder. Shouldn't be dead
on_title_gain_usurpation = {
	events = {
	}
}

# A title is lost by a character
# root = the old holder
# scope:title = the title that changes hands
# scope:new_holder = new holder.
on_title_lost = {
	events = {
	}
}

# A claim is gained by a character
# root = the claimant
# scope:title = the title that is claimed
on_explicit_claim_gain = {
	events = {
		coa.1 # check if title Coat of Arms should change.
	}
}

# A claim is lost by a character
# root = the claimant
# scope:title = the title that was claimed
on_explicit_claim_lost = {
	events = {
		coa.1 # check if title Coat of Arms should change.
	}
}

# A title change makes the character rank up in the landed tiers (eg Duke -> King)
# root = character ranking up
# scope:title = old primary title
on_rank_up = { # Will not fire during history execution or for dying characters
	events = {
	}
	effect = {
		add_achievement_flag = { FLAG = achievement_moving_up_in_the_world_flag }
		update_embassies_effect = yes
		every_ally = {
			update_embassies_effect = yes
		}
	}
}

# A title change makes the character rank down in the landed tiers (eg King -> Duke)
# root = character ranking down
# scope:title = old primary title
on_rank_down = { # Will not fire during history execution or for dying characters
	events = {
	}
	effect = {
		add_character_flag = {
			flag = make_suicide_available
			years = 5
		}
		update_embassies_effect = yes
		every_ally = {
			update_embassies_effect = yes
		}
	}
}
